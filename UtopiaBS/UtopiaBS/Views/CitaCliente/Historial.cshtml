@model IEnumerable<UtopiaBS.Entities.Cita>

@{
    ViewBag.Title = "Historial de Citas";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

<div class="container py-5" style="max-width:900px;">

    <h2 class="mb-4 fw-bold">
        <i class="bi bi-clock-history text-primary me-2"></i>
        Historial de Citas
    </h2>

    <!-- Mensajes -->
    @if (TempData["Info"] != null)
    {
        <div class="alert alert-info shadow-sm fw-semibold rounded-3">
            <i class="bi bi-info-circle me-2"></i> @TempData["Info"]
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger shadow-sm fw-semibold rounded-3">
            <i class="bi bi-exclamation-triangle me-2"></i> @TempData["Error"]
        </div>
    }

    @if (Model.Any())
    {
        <div class="timeline">
            @foreach (var cita in Model.OrderByDescending(c => c.FechaHora))
            {
                string estadoColor = cita.IdEstadoCita switch
                {
                    1 => "#0D6EFD", // pendiente
                    2 => "#198754", // confirmada
                    3 => "#DC3545", // cancelada
                    4 => "#6C757D", // disponible (poco aplicable en historial)
                    _ => "#FFC107"
                };

                string estadoTexto = cita.IdEstadoCita switch
                {
                    1 => "Pendiente",
                    2 => "Completada",
                    3 => "Cancelada",
                    4 => "Disponible",
                    _ => "Otro"
                };

                <div class="timeline-item">
                    <div class="timeline-icon" style="background:@estadoColor"></div>

                    <div class="timeline-card shadow-sm">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="fw-bold mb-0" style="color:@estadoColor;">
                                <i class="bi bi-calendar-event me-1"></i> @estadoTexto
                            </h5>
                            <span class="fw-semibold text-muted" style="font-size:14px;">
                                @cita.FechaHora.ToString("dd/MM/yyyy")
                            </span>
                        </div>

                        <hr />

                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <p class="text-secondary small mb-1">Hora</p>
                                <p class="fw-semibold">@cita.FechaHora.ToString("hh:mm tt")</p>
                            </div>

                            <div class="col-md-6 mb-2">
                                <p class="text-secondary small mb-1">Empleado</p>
                                <p class="fw-semibold">@((cita.Empleado?.Nombre) ?? "—")</p>
                            </div>

                            <div class="col-md-6 mb-2">
                                <p class="text-secondary small mb-1">Servicio</p>
                                <p class="fw-semibold">@((cita.Servicio?.Nombre) ?? "—")</p>
                            </div>

                            <div class="col-md-6 mb-2">
                                <p class="text-secondary small mb-1">Notas</p>
                                <p class="fw-semibold">@((string.IsNullOrWhiteSpace(cita.Observaciones) ? "—" : cita.Observaciones))</p>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

<style>
    body {
        background-color: #F1F5F9;
    }

    .timeline {
        position: relative;
        margin-left: 25px;
        padding-left: 20px;
        border-left: 3px solid #d0d7de;
    }

    .timeline-item {
        position: relative;
        margin-bottom: 40px;
    }

    .timeline-icon {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        position: absolute;
        left: -32px;
        top: 3px;
        border: 2px solid white;
        outline: 3px solid #d0d7de;
    }

    .timeline-card {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
    }

        .timeline-card:hover {
            transform: translateY(-2px);
            transition: 0.2s ease;
        }
</style>
